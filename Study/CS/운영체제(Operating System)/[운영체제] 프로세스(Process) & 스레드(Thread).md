# [운영체제] 프로세스(Process) & 스레드(Thread)
<br>

### 프로세스(Process)
> - **프로세스**란 프로그램을 메모리에 적재하여 CPU를 할당 받아 실행 중인 프로그램  
> - 운영체제로부터 자원을 할당받은 **작업의 단위**

<br>

각각의 **프로세스**는 **독립된 메모리 공간**을 할당 받는다.

<br>

---

<br>

### 스레드(Thread)
> - **스레드**란 프로그램 안에서 실행되는 여러 흐름 단위  
> - 프로세스가 할당받은 자원을 이용하는 **실행 흐름의 단위** 

<br>

기본적으로 **프로세스**는 최소 1개의 **스레드**를 소유하고 있다.

<br>

---

<br>

## 프로세스의 자원 구조
프로세스는 다음과 같이 4가지의 메모리 영역으로 구성되어 할당 받게 된다.

- 코드 영역(CODE) : 프로그래머가 작성한 프로그램 함수들의 코드들이 CPU가 해석 가능한 기계어 형태로 저장되어 있다.
- 데이터 영역(DATA) : 코드가 실행되면서 사용하는 전역 변수나 각종 데이터들이 모여 있다.
    - 초기화 된 데이터는 data 영역에 저장
    - 초기화 되지 않은 데이터는 bss 영역에 저장
- 힙 영역(HEAP) : 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위한 공간이다. 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다.
- 스택 영역(STACK) : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간이다. Stack은 함수 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.

```markdown
코드 영역과 데이터 영역은 선언할 때 크기가 결정되는 **정적 영역**이지만  
힙 영역과 스택 영역은 프로세스가 실행되는 동안 크기가 변화하는 **동적 영역**이다.
```

![](https://github.com/junhong625/TIL/assets/83000975/493b360d-fd06-42fb-9d9f-62eddbeb0ced)

<br>

---

<br>

## 프로세스와 스레드의 차이점
**프로세스** - 자신만의 **고유** 공간과 자원을 할당받아 사용(독립적)  
**스레드** - 다른 스레드와 stack을 제외한 나머지 공간과 자원을 **공유**하면서 사용

위와 같은 차이점으로 인해 스레드는 프로세스보다 빠르게 Context Switching 작업이 가능하다.

```markdown
Context Switching이란?
- cpu에서 현재 작업 중인 프로세스에서 다른 프로세스로 넘어갈 때 지금까지의 프로세스의 상태를 저장하고, 새 프로세스의 저장된 상태를 다시 적재하는 작업을 Context Switching이라 한다. 
```

---

<br>

## 멀티 프로세스와 멀티 스레드 
### 멀티 프로세스
> 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것

- 장점 
    - **안정성**  
    > 각 프로세스가 독립적인 메모리 공간을 가지므로, 한 프로세스가 비정상적으로 종료해도 다른 프로세스에 영향을 주지 않는다.
    - **시스템 확장성**
    > 각 프로세스가 독립적이므로 새로운 모듈, 기능을 추가하거나 수정할 때 다른 프로세스에 영향을 주지 않기에 쉽게 확장이 가능하다.
- 단점
    - **Context Switching Overhead**
    > 프로세스는 스레드와 다르게 메모리 자원 공유를 하지 않기에 Context Switching 시 현재 작업중인 프로세스의 상태를 PCB에 저장하고 다음 프로세스의 정보를 불러오기 위해 메모리 검색 및 CPU 캐시 메모리 초기화를 해야한다. 이러한 작업이 빈번하게 일어나게 된다면 비용 오버헤드가 발생할 수 있게 된다.
    - **자원 공유 비효율성**
    > 각 프로세스는 독립적인 메모리 공간을 가지기에 자원 공유가 필요할 경우 복잡한 통신 기법인 IPC를 사용해야 한다. IPC는 자체로 오버헤드가 발생하게 되고 코드의 복잡도를 증가시키기에 자원 공유에 있어 비효율적인 모습을 보인다.

<br>

### 멀티 스레드
> 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것

- 장점
    - **프로세스보다 가볍다**
    > 스레드는 프로세스 내에서 생성되고 생성 및 종료가 빠르다. 또한 스레드는 스택 영역을 제외한 나머지 영역을 공유하기에 프로세스보다 데이터 용량이 작기에 프로세스보다 가볍다.
    - **자원의 효율성**
    > 멀티 스레드는 각 스레드 간의 자원 공유가 가능하여 IPC를 사용하지 않고도 자원을 공유가 가능하다.
    - **Context Switching 비용 감소**
    > 스레드에도 Context Swithcing Overhead가 존재하지만 자원을 공유한다는 특성으로 인해 프로세스보다 비용이 낮다.

- 단점
    - **안정성 문제**
    > 스레드들은 서로 간의 자원을 공유하기에 하나의 스레드에서 문제가 발생하면 다른 스레드들에게도 영향이 가게 되어 안정성 문제가 발생할 수 있다.
    - **동기화로 인한 성능 저하**
    > 스레드들은 서로 간의 자원을 공유하기에 여러 스레드가 동시에 한 자원을 변경해 버린다면 치명적인 버그가 발생할수도 있다. 따라서 동기화 작업이 필요한데 이로 인해 병목 현상이 일어나 성능이 저하될 가능성이 존재한다.
    - **데드락**
    > 다수의 프로세스나 스레드가 서로 자원을 점유하고, 다른 프로세스나 스레드가 점유한 자원을 무한정 기다리는 교착 상태가 발생할 수 있다.
    - **Context Switching Overhead(??)**
    > 멀티 스레드는 멀티 프로세스에 비해 Context Switching 비용이 낮아 성능에 유리하다고 했지만 비용을 무시할 수는 없다. 특히 스레드 수가 많으면 그만큼 스위칭이 많이 발생하게 되고 이는 성능 저하로 이어진다. 그렇기에 스레드를 많이 쓸수록 항상 성능이 좋아지는지에 대한 고민이 필요하다.
    - **디버깅 난이도**
    > 멀티 스레드를 사용하면 여러 개의 스레드가 동시에 실행되기에 각 스레드의 동작을 추적하기 어려워 디버깅에 어려움을 겪을 수 있다.


---

참고 문헌  
- [https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread)  
- [https://www.youtube.com/watch?v=QmtYKZC0lMU&ab_channel=%EC%89%AC%EC%9A%B4%EC%BD%94%EB%93%9C](https://www.youtube.com/watch?v=QmtYKZC0lMU&ab_channel=%EC%89%AC%EC%9A%B4%EC%BD%94%EB%93%9C)
- [https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html](https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html)