# 3계층

## 3계층에서 하는 일

> 3계층은 다른 네트워크 대역 즉, 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어하는 일을 담당 + 발신에서 착신까지의 패킷 경로 제어
> 
- 서로 다른 LAN끼리 통신하기 위해 필요

### IP 주소

> WAN에서 통신할 때 사용하는 주소
> 
- IPv4 주소 : 현재 PC에 할당된 IP 주소
- 서브넷 마스크 : IP 주소에 대한 네트워크의 대역을 규정하는 것
- 게이트웨이 주소 : 외부와 통신할 때 사용하는 네트워크의 출입구
- `.` 로 구분

## 3계층 프로토콜

- ARP 프로토콜 : IP주소를 이용해 MAC 주소를 확인
- IPv4 프로토콜 : WAN에서 통신할 때 사용
- ICMP 프로토콜 : 서로가 통신되는지 확인할 때 사용

## 일반적인 IP 주소

### Classful IP 주소

| 클래스 | 네트워크 구분 | 시작 주소 | 마지막 주소 |
| --- | --- | --- | --- |
| A 클래스 | 0XXXXXXX, 첫번째 필드 | 0.0.0.0 | 127.255.255.255 |
| B 클래스 | 10XXXXXX, 두번째 필드 | 128.0.0.0 | 191.255.255.255 |
| C 클래스 | 110XXXXX, 세번째 필드 | 192.0.0.0 | 233.255.255.255 |
| D 클래스(멀티캐스트) | 1110XXXX | 224.0.0.0 | 239.255.255.255 |
| E 클래스(예약) | 1111XXXX | 240.0.0.0 | 255.255.255.255 |

### Classless IP 주소

> Classful한 네트워크 대역을 나눠주는데 사용하는 값
> 
- 32bit,  4bytes
- 2진수로 표기했을 때 1로 시작, 1과 1사이에는 0이 올 수 없다는 규칙을 가지고 있다.

### 사설 IP와 공인 IP

> 공인 IP 1개당 2^32개의 사설 IP
> 
- NAT(Network Address Translation) : 사설 IP 네트워크 대역에서 공인 IP 네트워크 대역으로 변환
    - 실제로 NAT기술은 특정 IP를 다른 IP로 변환할 뿐 사설 IP를 공인 IP로 변환하는 목적으로 만들어진건 아님
- 실제 인터넷 세상에서는 공인 IP로만 통신 → 외부 네트워크 대역에서는 사설 IP 대역이 보이지 않음
- NAT Table에 기록되지 않았을 경우 보낸적 없는 요청에는 응답을 받을 수 없기에 사용자의 요청에 대한 응답이 불가능함
    - 따라서 네이버 같은 서버에서는 공인 IP로 세팅
    - 포트포워딩을 쓰면 사설 IP에서도 접속이 가능

### 작동 방식

1. 사설 IP에서 Request를 하면 공인 IP(공유기)를 거쳐 외부로 통신
2. 공인 IP를 거쳐 나갈 때 NAT Table에 기록
3. 이후 Response가 공인 IP를 거쳐 들어오면 NAT Table을 조회
4. NAT Table에 남겨져 있는 기록을 확인하여 Response를 사설 IP로 전달

### 특수한 IP 주소

- 0.0.0.0 : 나머지 모든 IP
- 127.0.0.1 : 나 자신을 나타내는 주소
- 게이트웨이 주소 : 공유기 IP(나가는 문)